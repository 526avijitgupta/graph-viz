<!DOCTYPE html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<title>VisuAlgo - Max Flow</title>
<link rel="icon" type="image/png" href="img/favicon.png" />

<!--css-->
<link rel="stylesheet" href="css/normalize.css">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/viz.css">

<link rel="stylesheet" href="css/maxflow.css"> <!--not yet implemented-->

<!--js-->
<script src="js/external/jquery-1.10.2.js"></script>
<script src="js/external/jquery-ui.js"></script>
<script src="js/external/d3.v3.js"></script>
<script src="js/viz.js"></script>
<script src="js/common.js"></script>
<script src="js/actions/maxflow_actions.js"></script> <!--not yet implemented-->
<!--script src="//connect.facebook.net/en_US/all.js"></script-->

<!--fonts-->
<link href="fonts/silkscreen/stylesheet.css" rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>

</head>

<body>

<div id="top-bar">
  <a id="home" href="index.html">Visu<span class="colour">Algo</span></a>
    <span id="title">
      <a class="selected-viz">Max Flow</a>
    </span>
    <!--a id="fb-login" href="#" target="_blank">Facebook connect</a>
    <span id="trick">
    <fb:login-button show-faces="false" width="200" max-rows="1" style="float: right; margin-top: 9px;"></fb:login-button>
    </span-->
    <div id="mode-menu">
      <div id="mode-button">Exploration Mode<img src="img/arrow_white.png" alt="Home"/></div>
        <div id="other-modes">
            <a href="#">Tutorial Mode</a>
        </div>
    </div>
</div>
    
    <div id="viz"></div>
    
    <div id="current-action" class="panel"><p></p></div>
    
    <div id="actions" class="panel">
		<p id="draw" class="execAction" onclick=drawGraph()>Draw Graph</p>
        <p id="modeling" class="execAction">Modeling</p>
        <p id="create" class="execAction" onclick=createRandom("complete")>Random Graph</p>
        <!--<p id="bipartite" class="execAction">Bipartite Graph</p>-->
        <p id="sample" class="execAction">Sample Graphs</p>
        <p id="countmaxflow" class="execAction">Count Maximum Flow</p>
    </div>
    <div id="actions-hide" class="panel-hide"><img src="img/arrow_white_right.png" title="show/hide actions panel"/></div>
    <div id="actions-extras">
    <!--put all the extra action pullouts (input) and error messages here-->

        <div class="modeling action-menu-pullout">
            <div id="rookattack" class="execAction new-menu-option coloured-menu-option" onclick=modelingOpen("rookattack")><p>Rook Attack Modeling</p>
              <div id="rookattack-input" class="new-menu-option">
                <input type="text" id="rows" title="Enter the number of rows" autocomplete="off" value=5 />
                <input type="text" id="columns" title="Enter the number of column" autocomplete="off" value=5 />
                <div id="rookattack-go" class="execAction coloured-menu-option" onclick=modeling('rookattack') title="Generate the board"><p>GO</p></div>
              </div>
            </div>

            <div id="baseball" class="execAction new-menu-option coloured-menu-option" onclick=modelingOpen("baseball")><p>Baseball Elimination</p>
              <div id="baseball-input" class="new-menu-option">
                <div class="new-menu-option coloured-menu-option"><p>N = </p></div>
                <input type="text" id="teams" title="Enter the number of teams" autocomplete="off" value=4 />
                <div id="baseball-go" class="execAction coloured-menu-option" onclick=modeling('baseball') title="Generate the board"><p>GO</p></div>
              </div>
            </div>

            <div id="bipartite" class="execAction new-menu-option coloured-menu-option" onclick=modelingOpen("bipartite")>
              <p>Bipartite Matching</p>
              <div id="bipartite-input" class="new-menu-option">
                <div id="bipartite0" class="execAction new-menu-option coloured-menu-option" onclick=createRandom("bipartite0")><p>random</p></div>
                <div id="bipartite1" class="execAction new-menu-option coloured-menu-option" onclick=createRandom("bipartite1")><p>left 1</p></div>
                <div id="bipartite2" class="execAction new-menu-option coloured-menu-option" onclick=createRandom("bipartite2")><p>right 1</p></div>
                <div id="bipartite3" class="execAction new-menu-option coloured-menu-option" onclick=createRandom("bipartite3")><p>all 1</p></div>
              </div>
            </div>

            <div id="modeling-err" class="err"></div>
        </div>

        <div class="create action-menu-pullout">
            <div id="create-err" class="err"></div>
        </div>

        <div class="samples action-menu-pullout">
            <div id="sample0" class="execAction new-menu-option coloured-menu-option" onclick=sample(MAXFLOW_EXAMPLE_CP3_4_24)><p>CP3 4.24</p></div>
            <div id="sample1" class="execAction new-menu-option coloured-menu-option" onclick=sample(MAXFLOW_EXAMPLE_CP3_4_26_1)><p>CP3 4.26.1</p></div>
            <div id="sample2" class="execAction new-menu-option coloured-menu-option" onclick=sample(MAXFLOW_EXAMPLE_CP3_4_26_2)><p>CP3 4.26.2</p></div>
            <div id="sample3" class="execAction new-menu-option coloured-menu-option" onclick=sample(MAXFLOW_EXAMPLE_CP3_4_26_3)><p>CP3 4.26.3</p></div>
            <div id="sample4" class="execAction new-menu-option coloured-menu-option" onclick=sample(MAXFLOW_EXAMPLE_FORD_KILLER)><p>Ford Fulkerson Killer Case</p></div>
            <div id="sample4" class="execAction new-menu-option coloured-menu-option" onclick=sample(MAXFLOW_EXAMPLE_1)><p>Example 1</p></div>
            <div id="samples-err" class="err" style="z-index: 2000;"></div>
        </div>   

        <div class="countmaxflow action-menu-pullout">
          <div class="new-menu-option coloured-menu-option"><p>s = </p></div>
            <div id="countmaxflow-input" class="new-menu-option"><input type="text" id="sourcevertex" title="Enter the source vertex" autocomplete="off" value=0 /></div>
            <div class="new-menu-option coloured-menu-option"><p>t = </p></div>
            <div id="countmaxflow-input" class="new-menu-option"><input type="text" id="sinkvertex" title="Enter the sink vertex" autocomplete="off" value=3 /></div>
            <div id="countmaxflow-go" class="execAction coloured-menu-option" onclick=countmaxflow('GO') title="Run Maximum Flow">
              <p>GO</p>
            </div>
            <div id="countmaxflow-algorithm">
              <div id="countmaxflow-fordfulkerson" class="execAction coloured-menu-option" onclick=countmaxflow('fordfulkerson') title="Use Ford Fulkerson algorithm"><p>Ford Fulkerson</p></div>
              <div id="countmaxflow-edmondskarp" class="execAction coloured-menu-option" onclick=countmaxflow('edmondskarp') title="Use Edmonds Karp algorithm"><p>Edmonds Karp</p></div>
              <div id="countmaxflow-dinic" class="execAction coloured-menu-option" onclick=countmaxflow('dinic') title="Use Dinic algorithm"><p>Dinic</p></div>
            </div>
            <div id="countmaxflow-err" class="err"></div>
        </div>
    </div>
    
    <div id="status" class="panel"><p></p></div>
    <div id="status-hide" class="panel-hide"><img src="img/arrow_white_right.png" title="show/hide status panel"/></div>
    
    <div id="codetrace" class="panel">
    <!--can add class "highlighed" to hightlight one line-->
    <p id="code1" style="padding-top: 10px;"></p>
    <p id="code2"></p>
    <p id="code3"></p>
    <p id="code4"></p>
    <p id="code5"></p>
    <p id="code6"></p>
    <p id="code7" style="padding-bottom: 10px;"></p>
    </div>
    <div id="codetrace-hide" class="panel-hide"><img src="img/arrow_white_right.png" title="show/hide codetrace panel"/></div>
    
<div id="left-bar"></div>
<div id="right-bar"></div>
<!-- Bottom bar and overlay popups -->
<div id="bottom-bar">
	<a id="trigger-about">About</a>
    <a id="trigger-team">Team</a>
    <a id="trigger-terms">Terms of use</a>
</div>

<div id="media-controls">
	<div id="speed-control">slow<div id="speed-input"></div>fast</div>
	<span id="go-to-beginning" class="media-control-button" title="go to beginning" onclick=goToBeginning()><img src="img/goToBeginning.png" alt="go to beginning" /></span>
	<span id="previous" class="media-control-button" title="step backward" onclick=stepBackward()><img src="img/prevFrame.png" alt="previous frame" /></span>
    <span id="pause" class="media-control-button" title="pause" onclick=pause()><img src="img/pause.png" alt="pause" /></span>
    <span id="play" class="media-control-button" title="play" onclick=play()><img src="img/play.png" alt="play" /></span>
    <span id="next" class="media-control-button" title="step forward" onclick=stepForward()><img src="img/nextFrame.png" alt="next frame" /></span>
    <span id="go-to-end" class="media-control-button" title="go to end" onclick=goToEnd()><img src="img/goToEnd.png" alt="go to end"/></span>
    <div id="progress-bar" class="media-control-button"></div>
</div>

<div id="dark-overlay"></div>
<div id="about" class="overlays"></div>
<div id="team" class="overlays"></div>
<div id="termsofuse" class="overlays"></div>
<div id="drawgraph" class="overlays">
  <!--
    <iframe id="gajah" width="1000" height="600" src="drawmst.html"></iframe>
  -->
  <script>var JSONresult;</script>
  <script src="./visual_final.js"></script>
  <link rel="stylesheet" href="./visual.css">
  <div id="main">
    <div id="viz">

      <svg onClick = "GraphVisu(false,false); " width="960" height="450"><defs><marker id="end-arrow" viewBox="0 -5 10 10" refX="6" markerWidth="3" markerHeight="3" orient="auto"><path d="M0,-5L10,0L0,5" fill="#000"></path></marker></defs><path class="link dragline hidden" d="M0,0L0,0"></path><g><path class="link" d="M108.48528137423857,108.48528137423857L191.51471862576142,191.51471862576142"></path><path class="link" d="M208.48528137423858,208.48528137423858L291.5147186257614,291.5147186257614"></path></g><g><g><circle class="node" r="16" cx="100" cy="100" style="fill: rgb(238, 238, 238);"></circle><text x="100" y="105.33333333333333" class="id">0</text></g><g><circle class="node" r="16" cx="200" cy="200" style="fill: rgb(238, 238, 238);"></circle><text x="200" y="205.33333333333334" class="id">1</text></g><g><circle class="node" r="16" cx="300" cy="300" style="fill: rgb(238, 238, 238);"></circle><text x="300" y="305.3333333333333" class="id">2</text></g></g><g></g>
      <text x = "400" y = "100"> &bull; Click on empty space to add vertex</text>
      <text x = "400" y = "125"> &bull; Drag from vertex to vertex to add edge</text>
      <text x = "400" y = "150"> &bull; Select + Delete to delete vertex/edge</text>
      <text x = "400" y = "175"> &bull; Select Edge + Enter to change edge's weight</text>
      <text x = "400" y = "200"> &bull; Press Ctrl to Drag vertex around</text>
      <text x = "400" y = "250"> &bull; Click anywhere to switch to our default mode undirected/unweighted </text>
      <text x = "400" y = "275"> or choose another graph drawing mode </text>
    </svg>
  </div>


  <div id="drawgraph-actions">
    <p onclick=drawDone()>Done</p>
    <p onclick=drawCancel()>Cancel</p>
    <p onclick=GraphVisu(false,false)>Clear</p>
  </div>
  <div id="draw-err" class="err"></div>

</div>
<div id="rookattack-board" class="overlays"></div>
<div id="baseball-board" class="overlays"></div>

<!--tutorial dialogs here-->
<div id="maxflow-tutorial-1" class="tutorial-dialog">
  In the Maximum Flow (maxflow) problem, we aim to find the maximum flow from a particular source node to a particular sink node in the graph. <br/><br/>There are many algorithms for finding the maximum flow.
  <div class="tutorial-next">Next<img src="img/arrow_white_right.png"/></div>
</div>
<div id="maxflow-tutorial-2" class="tutorial-dialog">
  Choose a sample graph <!--or draw your own graph-->and try running the different maxflow algorithms on it using 'Count Maximum Flow' menu:<br/><br/>The slow <strong>Ford Fulkerson algorithm</strong>, <br/>The O(VE^2) <strong>Edmonds Karp algorithm</strong>, or<br/>The O(V^2) <strong>Dinic's algorithm</strong>
  <div class="tutorial-next">Next<img src="img/arrow_white_right.png"/></div>
</div>
<div id="maxflow-tutorial-3" class="tutorial-dialog">
	A lot of problems are solveable using maxflow. One of the example is the famous Rook Attack problem. Click 'Modeling' menu to see more problems that are solveable using maxflow and how to solve them.
    <div class="tutorial-next">Next<img src="img/arrow_white_right.png"/></div>
</div>
<div id="maxflow-tutorial-4" class="tutorial-dialog">
	The status bar explains the execution of the algorithm at each animation step.
    <div class="tutorial-next">Next<img src="img/arrow_white_right.png"/></div>
</div>
<div id="maxflow-tutorial-5" class="tutorial-dialog">
	You can also follow the psuedocode highlights to trace the algorithm.
    <div class="tutorial-next">Next<img src="img/arrow_white_right.png"/></div>
</div>
<div id="maxflow-tutorial-6" class="tutorial-dialog">
  Control the animation with the player controls! Keyboard shortcuts are:<br/>
    <div style="margin-top: 8px;"><strong>Spacebar:</strong> play/pause/replay</div>
    <strong>Left/right arrows:</strong> step backward/step forward<br/>
    <strong>-/+:</strong> decrease/increase speed<br/>
    <div class="tutorial-next">Next<img src="img/arrow_white_right.png"/></div>
</div>
<div id="maxflow-tutorial-7" class="tutorial-dialog">
  Return to "Exploration Mode" to start exploring!
</div>

<script src="js/graph_library/constant.js"></script>
<script src="js/graph_library/properties.js"></script>
<script src="js/graph_library/helperObjects.js"></script>
<script src="js/graph_library/misc.js"></script>
<script src="js/graph_library/Widget.js"></script>
<script src="js/graph_library/GraphWidget.js"></script>
<script src="js/graph_library/GraphVertexWidget.js"></script>
<script src="js/graph_library/GraphEdgeWidget.js"></script>
<script src="js/widgets/MaxflowWidget.js"></script>

<script type="text/javascript">
  //start by showing actions panel
  $('#play').hide();

  var maxflowWidget = new MAXFLOW();
  var gw = maxflowWidget.getGraphWidget();
  maxflowWidget.examples(MAXFLOW_EXAMPLE_CP3_4_24);
  
  function drawGraph() {
    if(isPlaying) { stop(); }
    if (mode=="exploration") 
    {
      $('#dark-overlay').fadeIn(function(){
        $('#drawgraph').fadeIn();
        //$('#drawgraph').html('<iframe width="1000" height="600" src="drawmst.html"></iframe>');
      });
      isPlaying = false;
    }
  }
  
  function drawDone()
  {
    if (!maxflowWidget.draw(JSONresult)) return false;
    $("#draw-err").html("");
    $('#drawgraph').fadeOut();
    $('#dark-overlay').fadeOut();
  }

  function drawCancel()
  {
    $('#drawgraph').fadeOut();
    $('#dark-overlay').fadeOut();
  }

  function createRandom(randomType) {
    closeModeling();
    if(isPlaying) { stop(); }
    if (mode=="exploration") {
      maxflowWidget.initRandom(randomType);
      $('#progress-bar').slider( "option", "max", 0);
      closeSamples();
      closeCountMaximumFlow();
      isPlaying = false;
    }
  }

  function sample(id) {
    if(isPlaying) { stop(); }
    setTimeout( function() {
      if ((mode=="exploration")&&maxflowWidget.examples(id)) {
        $('#progress-bar').slider( "option", "max", 0);
		    closeSamples();
        closeCountMaximumFlow();
        isPlaying = false;
      }
    }, 500);
  }

  function countmaxflow(algorithm)
  {
    if (algorithm == 'GO')
    {
      $('#countmaxflow-go').hide();
      $('#countmaxflow-algorithm').fadeIn('fast');
      return;
    }
    if(isPlaying) { stop(); }
    var source = parseInt($('#sourcevertex').val());
    var sink = parseInt($('#sinkvertex').val());
    setTimeout( function() 
    {
      if (mode != "exploration") return;
      if (!maxflowWidget.countmaxflow(algorithm,source,sink)) return;
      $('#current-action').show();
      if (algorithm == "edmondskarp")
        $('#current-action p').html("Edmonds Karp(" + source + "," + sink + ")");
      if (algorithm == "fordfulkerson")
        $('#current-action p').html("Ford Fulkerson(" + source + "," + sink + ")");
      if (algorithm == "dinic")
        $('#current-action p').html("Dinic(" + source + "," + sink + ")");
      $('#progress-bar').slider( "option", "max", gw.getTotalIteration()-1);
      triggerRightPanels();
      isPlaying = true;
    }, 500);
  }

  function modelingOpen(modelingType)
  {
    $(".modeling").css("bottom","117px");
    if (modelingType != "rookattack") $('#rookattack-input').fadeOut('fast');
    if (modelingType != "baseball")   $('#baseball-input').fadeOut('fast');
    if (modelingType != "bipartite")  $('#bipartite-input').fadeOut('fast');
    $('#' + modelingType + '-input').fadeIn('fast');
  }

  function modeling(modelingType)
  {
    if(isPlaying) { stop(); }
    setTimeout( function() 
    {
      if (mode != "exploration") return;
      if (!maxflowWidget.modeling(modelingType)) return;
    }, 500);
  }

  //playback controls might fit better in viz.js, but put here in case some viz does not use GraphWidget.js
  var isPaused = false;
  function isAtEnd() {
    return (gw.getCurrentIteration()==(gw.getTotalIteration()-1));
  }
  
  function pause() {
    if(isPlaying) {
      isPaused = true;
      gw.pause();
      $('#play').show();
      $('#pause').hide();
    }
  }
  function play() {
    if(isPlaying) {
      isPaused = false;
      $('#pause').show();
      $('#play').hide();
      if(isAtEnd()) {
        gw.replay();
      } else {
        gw.play();
      }
    }
  }
  function stepForward() {
    if(isPlaying) {
      pause();
      gw.forceNext(250);
    }
  }
  function stepBackward() {
    if(isPlaying) {
      pause();
      gw.forcePrevious(250);  
    }
  }
  function goToBeginning() {
    if(isPlaying) {
      gw.jumpToIteration(0,0);
      pause();
    }
  }
  function goToEnd() {
    if(isPlaying) {
      gw.jumpToIteration(gw.getTotalIteration()-1,0);
      pause();
    }
  }
  function stop() {
    gw.stop();
    isPaused = false;
    isPlaying = false;
    $('#pause').show();
    $('#play').hide();
  }
  
  //shortcut keys for playback controls
  $(document).keydown( function(event) {
    if(event.which == 32) { //spacebar
      if(isPaused) { play(); } else { pause(); }
    } else if(event.which == 37) { //left arrow
      stepBackward();
    } else if(event.which == 39) { //right arrow
      stepForward();
    } else if(event.which == 35) { //end
      stop();
    } else if (event.which == 189) { //minus
      var d = (2200-gw.getAnimationDuration())-100;
      if(d > 0) {
        $("#speed-input").slider("value", d);
      } else {
        $("#speed-input").slider("value", 0);
      }
    } else if (event.which == 187) { //plus
      var d = (2200-gw.getAnimationDuration())+100;
      if(d <= 2000) {
        $("#speed-input").slider("value", d);
      } else {
        $("#speed-input").slider("value", 2000);
      }
    }
  });
  
  //sliders
  $("#speed-input").slider({
    min: 200,
    max: 2000,
    value: 1700,
    change: function(event, ui) {
      gw.setAnimationDuration(2200-ui.value);
    }
  });
  $("#progress-bar").slider({
    range: "min",
    min: 0,
    value: 0,
    slide: function(event, ui) {
      gw.pause();
      gw.jumpToIteration(ui.value,0);
    },
    stop: function(event, ui) {
      if(!isPaused) { setTimeout( function(){gw.play();}, 500) }
    }
  });
  
</script>

</body>
</html>
